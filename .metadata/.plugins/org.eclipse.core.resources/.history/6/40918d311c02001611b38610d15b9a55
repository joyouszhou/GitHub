package com.zhgame.common.custom;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.util.StringUtils;

import com.zhgame.common.core.spring.SpringContextHolder;
import com.zhgame.common.utils.PropertiesUtil;
import com.zhgame.modules.app.service.AppService;

public class SyncTask {
    protected final Logger logger = LoggerFactory.getLogger(getClass());

    public synchronized void appSync() throws Exception {
        String onOff = PropertiesUtil.getProperty("task.appSync.switch");
        if (onOff == null || StringUtils.isEmpty(onOff)) {
            onOff = "off";
        }
        if ("on".equals(onOff)) {
            AppService appService = SpringContextHolder.getBean("appService");
            appService.sync();
        }
    }
    
/*    
 *  <!--old-->
 *  
 	public synchronized void appSync() throws Exception {
    	String onOff = PropertiesUtil.getProperty("task.appSync.switch");
    	if (onOff == null || StringUtils.isEmpty(onOff)) {
    		onOff = "off";
    	}
    	if ("on".equals(onOff)) {
    		AppService appService = SpringContextHolder.getBean("appService");
    		ForAppQueryForm forAppQueryForm = new ForAppQueryForm();
    		
    		String appKey = BillingUtil.getBillingAppKey();
    		forAppQueryForm.setAppKey(appKey);
    		forAppQueryForm.setTag("123");
    		forAppQueryForm.setChannelId("2001");
    		
    		appService.sync(forAppQueryForm);
    		logger.debug(RedisUtil.getMapSize("apps").toString());
    		for (Entry<String, Object> entry : RedisUtil.getMap("apps").entrySet()) {
    			logger.debug(entry.getKey() + ":" + entry.getValue());
    		}
    	}
    }
*/}

package com.zhgame.common.core.spring;

import javax.servlet.http.HttpServletRequest;

import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.zhgame.common.custom.base.ErrorResponse;

/**
 * 默认跳转的controller,
 * 当用户地址输出错误时跳转到此controller处理
 * @author lijingdong
 * 2013-12-30
 */
@Controller
public class DefaultSpringController {
	
	@RequestMapping(produces = MediaType.APPLICATION_JSON_VALUE)
	@ResponseBody
	public Object forwardRequest(final HttpServletRequest request) {
		StringBuffer url = new StringBuffer();
		String scheme = request.getScheme();
		int port = request.getServerPort();
		if (port < 0) port = 80;
		url.append(scheme);
		url.append("://");
		url.append(request.getServerName());
		if ((scheme.equals("http") && (port != 80)) || (scheme.equals("https") && (port != 443))) {
			url.append(':');
			url.append(port);
		}
		url.append(request.getRequestURI());
		String queryString = request.getQueryString();
		if (queryString != null) url.append('?').append(queryString);
		String ret = url.toString();
		String msg = "接口不存在/请求的HTTP METHOD不支持";
		ErrorResponse error = new ErrorResponse(10001, msg , msg, ret);
		return new ResponseEntity<ErrorResponse>(error, HttpStatus.BAD_REQUEST);
	}

}
